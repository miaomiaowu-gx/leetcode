## 28. å®ç°strStr()

```
å®ç° strStr() å‡½æ•°ã€‚ 
ç»™å®šä¸€ä¸ª haystack å­—ç¬¦ä¸²å’Œä¸€ä¸ª needle å­—ç¬¦ä¸²ï¼Œåœ¨ haystack å­—ç¬¦ä¸²ä¸­æ‰¾å‡º needle å­—ç¬¦ä¸²å‡ºç°çš„ç¬¬ä¸€ä¸ªä½ç½® (ä»0å¼€å§‹)ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¿”å› -1ã€‚ 

ç¤ºä¾‹ 1: 
è¾“å…¥: haystack = "hello", needle = "ll"
è¾“å‡º: 2

ç¤ºä¾‹ 2: 
è¾“å…¥: haystack = "aaaaa", needle = "bba"
è¾“å‡º: -1

è¯´æ˜: 
å½“ needle æ˜¯ç©ºå­—ç¬¦ä¸²æ—¶ï¼Œæˆ‘ä»¬åº”å½“è¿”å›ä»€ä¹ˆå€¼å‘¢ï¼Ÿè¿™æ˜¯ä¸€ä¸ªåœ¨é¢è¯•ä¸­å¾ˆå¥½çš„é—®é¢˜ã€‚ 
å¯¹äºæœ¬é¢˜è€Œè¨€ï¼Œå½“ needle æ˜¯ç©ºå­—ç¬¦ä¸²æ—¶æˆ‘ä»¬åº”å½“è¿”å› 0 ã€‚è¿™ä¸Cè¯­è¨€çš„ strstr() ä»¥åŠ Javaçš„ indexOf() å®šä¹‰ç›¸ç¬¦ã€‚ 

Related Topics åŒæŒ‡é’ˆ å­—ç¬¦ä¸² 
```


### æ–¹æ³•ä¸€ã€å­ä¸²é€ä¸€æ¯”è¾ƒ - [ä¸æ¨è]

ä» haystack å­—ç¬¦ä¸²å¤´éƒ¨å¼€å§‹ï¼Œä¸æ–­æˆªå–ä¸ needle å­—ç¬¦ä¸²ç­‰é•¿çš„å­å­—ç¬¦ä¸²ï¼Œå¹¶ä¸ needle å­—ç¬¦ä¸²æ¯”è¾ƒã€‚

```java
class Solution {
    public int strStr(String haystack, String needle) {
        //if(needle =="") return 0;
        int L = needle.length(), n = haystack.length();

        for (int start = 0; start < n - L + 1; ++start) {
            if (haystack.substring(start, start + L).equals(needle)) {
                return start;
            }
        }
        return -1;
    }
}
```
**ç¼ºé™·**ï¼šä¼šå°† haystack æ‰€æœ‰é•¿åº¦ä¸º L çš„å­ä¸²éƒ½ä¸ needle å­—ç¬¦ä¸²æ¯”è¾ƒ


**å¤æ‚åº¦åˆ†æ**

* æ—¶é—´å¤æ‚åº¦ï¼šO((N - L)L)ï¼Œå…¶ä¸­ N ä¸º haystack å­—ç¬¦ä¸²çš„é•¿åº¦ï¼ŒL ä¸º needle å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚å†…å¾ªç¯ä¸­æ¯”è¾ƒå­—ç¬¦ä¸²çš„å¤æ‚åº¦ä¸º Lï¼Œæ€»å…±éœ€è¦æ¯”è¾ƒ (N - L) æ¬¡ã€‚

* ç©ºé—´å¤æ‚åº¦ï¼šO(1)ã€‚



### æ–¹æ³•äºŒã€åŒæŒ‡é’ˆ - [ä¸€èˆ¬]

åªæœ‰å­ä¸²çš„ç¬¬ä¸€ä¸ªå­—ç¬¦è·Ÿ needle å­—ç¬¦ä¸²ç¬¬ä¸€ä¸ªå­—ç¬¦**ç›¸åŒ**çš„æ—¶å€™æ‰éœ€è¦æ¯”è¾ƒã€‚

åŒæŒ‡é’ˆï¼špn æŒ‡å‘ haystack å­—ç¬¦ä¸²ï¼ŒpL æŒ‡å‘ needle å­—ç¬¦ä¸²ï¼Œcurr_len ä¸ºå½“å‰åŒ¹é…çš„é•¿åº¦ã€‚

* ç§»åŠ¨ pn æŒ‡é’ˆï¼Œç›´åˆ° pn æ‰€æŒ‡å‘ä½ç½®çš„å­—ç¬¦ä¸ needle å­—ç¬¦ä¸²ç¬¬ä¸€ä¸ªå­—ç¬¦ç›¸ç­‰ã€‚

* é€æ­¥å‘åç§»åŠ¨æŒ‡é’ˆ pnï¼ŒpLï¼Œå¦‚æœåŒ¹é…ï¼Œåˆ™å¢åŠ  curr_lenï¼Œä¸åŒ¹é…åˆ™åœæ­¢ã€‚

   * å¦‚æœå®Œå…¨åŒ¹é…ï¼ˆå³ curr_len == Lï¼‰ï¼Œè¿”å›åŒ¹é…å­ä¸²çš„èµ·å§‹åæ ‡ï¼ˆå³ pn - Lï¼‰ã€‚

   * å¦‚æœä¸å®Œå…¨åŒ¹é…ï¼Œå›æº¯ã€‚ä½¿ pn = pn - curr_len + 1ï¼Œ pL = 0ï¼Œ curr_len = 0ã€‚

```java
class Solution {
  public int strStr(String haystack, String needle) {
    int L = needle.length(), n = haystack.length();
    if (L == 0) return 0;

    int pn = 0;
    while (pn < n - L + 1) {

      while (pn < n - L + 1 && haystack.charAt(pn) != needle.charAt(0)) ++pn;

      // compute the max match string
      int currLen = 0, pL = 0;
      while (pL < L && pn < n && haystack.charAt(pn) == needle.charAt(pL)) {
        ++pn;
        ++pL;
        ++currLen;
      }

      if (currLen == L) return pn - L;

      // otherwise, backtrack
      pn = pn - currLen + 1;
    }
    return -1;
  }
}
```

**å¤æ‚åº¦åˆ†æ**

* æ—¶é—´å¤æ‚åº¦ï¼šæœ€åæ—¶é—´å¤æ‚åº¦ä¸º O((N - L)L)ï¼Œæœ€ä¼˜æ—¶é—´å¤æ‚åº¦ä¸º O(N)ã€‚

* ç©ºé—´å¤æ‚åº¦ï¼šO(1)ã€‚


### æ–¹æ³•ä¸‰ã€ Rabin Karp - [ğŸ“å¸¸æ•°å¤æ‚åº¦ğŸ“]

æ€è·¯ï¼šå…ˆç”Ÿæˆçª—å£å†…å­ä¸²çš„å“ˆå¸Œç ï¼Œç„¶åå†è·Ÿ needle å­—ç¬¦ä¸²çš„å“ˆå¸Œç åšæ¯”è¾ƒã€‚å› æ­¤é—®é¢˜è½¬åŒ–ä¸ºå¦‚ä½•åœ¨å¸¸æ•°æ—¶é—´ç”Ÿæˆå­ä¸²çš„å“ˆå¸Œç ã€‚

**æ»šåŠ¨å“ˆå¸Œï¼šå¸¸æ•°æ—¶é—´ç”Ÿæˆå“ˆå¸Œç **

å¸¸æ•°æ—¶é—´ç”Ÿæˆæ»‘åŠ¨çª—å£æ•°ç»„çš„å“ˆå¸Œç ï¼šåˆ©ç”¨æ»‘åŠ¨çª—å£çš„ç‰¹æ€§ï¼Œæ¯æ¬¡æ»‘åŠ¨éƒ½æœ‰ä¸€ä¸ªå…ƒç´ è¿›ï¼Œä¸€ä¸ªå‡ºã€‚

ç”±äºåªä¼šå‡ºç°å°å†™çš„è‹±æ–‡å­—æ¯ï¼Œå› æ­¤å¯ä»¥å°†å­—ç¬¦ä¸²è½¬åŒ–æˆå€¼ä¸º 0 åˆ° 25 çš„æ•´æ•°æ•°ç»„ï¼š`arr[i] = (int)S.charAt(i) - (int)'a'`ã€‚æŒ‰ç…§è¿™ç§è§„åˆ™ï¼Œ`abcd` æ•´æ•°æ•°ç»„å½¢å¼å°±æ˜¯ `[0, 1, 2, 3]`ï¼Œè½¬æ¢å…¬å¼å¦‚ä¸‹æ‰€ç¤ºã€‚


$$
h_0 =0Ã—26^3
 +1Ã—26^2
 +2Ã—26^1
 +3Ã—26^0
$$

å¯ä»¥å°†ä¸Šé¢çš„å…¬å¼å†™æˆé€šå¼ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚å…¶ä¸­ $$c_i$$ ä¸ºæ•´æ•°æ•°ç»„ä¸­çš„å…ƒç´ ï¼Œ`a = 26`ï¼Œå…¶ä¸ºå­—ç¬¦é›†çš„ä¸ªæ•°ã€‚



$$
h_0 = c_0a^{Lâˆ’1} + c_1a^{Lâˆ’2} +...+ c_ia^{Lâˆ’1âˆ’i} +...+ c_{Lâˆ’1}a^0 
$$

ä¸‹é¢æ¥è€ƒè™‘çª—å£ä» `abcd` æ»‘åŠ¨åˆ° `bcde` çš„æƒ…å†µã€‚è¿™æ—¶å€™æ•´æ•°å½¢å¼æ•°ç»„ä» `[0, 1, 2, 3]` å˜æˆäº† `[1, 2, 3, 4]`ï¼Œæ•°ç»„æœ€å·¦è¾¹çš„ `0` è¢«ç§»é™¤ï¼ŒåŒæ—¶æœ€å³è¾¹æ–°æ·»äº† `4`ã€‚æ»‘åŠ¨åæ•°ç»„çš„å“ˆå¸Œå€¼å¯ä»¥æ ¹æ®æ»‘åŠ¨å‰æ•°ç»„çš„å“ˆå¸Œå€¼æ¥è®¡ç®—ï¼Œè®¡ç®—å…¬å¼å¦‚ä¸‹æ‰€ç¤ºã€‚



$$
h_1 = (h_0 âˆ’ 0Ã—26^3)Ã—26+4Ã—26^0
$$

å†™æˆé€šå¼å¦‚ä¸‹æ‰€ç¤º:



$$
h_1 = (h_0a - c_0a^L) + c_L
$$

 

**å¦‚ä½•é¿å…æº¢å‡º**

$$a^L$$ å¯èƒ½æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ•°å­—ï¼Œå› æ­¤éœ€è¦è®¾ç½®æ•°å€¼ä¸Šé™æ¥é¿å…æº¢å‡ºã€‚è®¾ç½®æ•°å€¼ä¸Šé™å¯ä»¥ç”¨å–æ¨¡çš„æ–¹å¼ï¼Œå³ç”¨ `h % modulus` æ¥ä»£æ›¿åŸæœ¬çš„å“ˆå¸Œå€¼ã€‚å– $$ modulus = 2^{31} $$ã€‚



**ç®—æ³•**

* è®¡ç®—å­å­—ç¬¦ä¸² `haystack.substring(0, L)` å’Œ `needle.substring(0, L)` çš„å“ˆå¸Œå€¼ã€‚

* ä»èµ·å§‹ä½ç½®å¼€å§‹éå†ï¼šä»ç¬¬ä¸€ä¸ªå­—ç¬¦éå†åˆ°ç¬¬ N - L ä¸ªå­—ç¬¦ã€‚

   * æ ¹æ®å‰ä¸€ä¸ªå“ˆå¸Œå€¼è®¡ç®—æ»šåŠ¨å“ˆå¸Œã€‚

   * å¦‚æœå­å­—ç¬¦ä¸²å“ˆå¸Œå€¼ä¸ needle å­—ç¬¦ä¸²å“ˆå¸Œå€¼ç›¸ç­‰ï¼Œè¿”å›æ»‘åŠ¨çª—å£èµ·å§‹ä½ç½®ã€‚

* è¿”å› -1ï¼Œè¿™æ—¶å€™ haystack å­—ç¬¦ä¸²ä¸­ä¸å­˜åœ¨ needle å­—ç¬¦ä¸²ã€‚



```java
class Solution {

    public int charToInt(int idx, String s){
        return (int)s.charAt(idx) - (int)'a';
    }

    public int strStr(String haystack, String needle) {
        int L = needle.length(), n = haystack.length();
        if(L>n) return -1;

        int a = 26;
        long modulus = (long)Math.pow(2,31);

        long h = 0, ref_h = 0;
        long aL = 1;
        for(int i=0; i<L; i++){
            h = (h * a + charToInt(i, haystack)) % modulus;
            ref_h = (ref_h * a + charToInt(i, needle)) % modulus;
            aL = (aL * a) % modulus;
        }

        if(h == ref_h) return 0;

        for(int start = 1; start<n-L+1; start++){
            h = (h *a - charToInt(start - 1, haystack)* aL + charToInt(start+L-1, haystack))%modulus;
            if(h == ref_h) return start;
        }

        return -1;

    }
}

```





**å¤æ‚åº¦åˆ†æ**

* æ—¶é—´å¤æ‚åº¦ï¼šO(N)ï¼Œè®¡ç®— needle å­—ç¬¦ä¸²çš„å“ˆå¸Œå€¼éœ€è¦ O(L) æ—¶é—´ï¼Œä¹‹åéœ€è¦æ‰§è¡Œ (N - L) æ¬¡å¾ªç¯ï¼Œæ¯æ¬¡å¾ªç¯çš„è®¡ç®—å¤æ‚åº¦ä¸ºå¸¸æ•°ã€‚

*ç©ºé—´å¤æ‚åº¦ï¼šO(1)ã€‚






